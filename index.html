<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard QA - Bank Jakarta</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              bj: {
                red: "#b91c1c",
                redSoft: "#fecaca",
                redSoft2: "#fee2e2",
                dark: "#1f2937",
                darkSoft: "#111827",
              },
            },
          },
        },
      };
    </script>
  </head>

  <body class="min-h-screen bg-slate-100 text-slate-900">
    <div class="flex min-h-screen">
      <!-- SIDEBAR -->
      <aside class="hidden md:flex w-64 flex-col bg-bj-red text-white shadow-xl">
        <!-- Logo -->
        <div class="flex items-center gap-3 px-6 py-4 border-b border-red-700/40">
          <div
            class="h-10 w-10 flex items-center justify-center rounded-full bg-white/10 border border-white/30 overflow-hidden"
          >
            <img src="bankjakarta.png" alt="Bank Jakarta" class="h-8 object-contain" />
          </div>
          <div>
            <p class="text-xs uppercase tracking-[0.2em] text-red-100/80">Bank Jakarta</p>
            <p class="text-sm font-semibold">QA Monitoring</p>
          </div>
        </div>

        <!-- Menu -->
        <nav class="flex-1 px-3 py-4 space-y-1 text-sm">
          <h2
            class="px-3 text-[11px] font-semibold uppercase tracking-[0.2em] text-red-100/70 mb-2"
          >
            Main
          </h2>

          <button
            class="w-full flex items-center gap-3 rounded-lg px-3 py-2 bg-white/15 text-white shadow-sm shadow-black/20"
          >
            <span
              class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-white/15 text-xs"
              >üìä</span
            >
            <span class="flex-1 text-left">Dashboard QA</span>
          </button>

          <!-- SIDEBAR: Generate Dokumen -->
          <button
            onclick="openSheetPanel()"
            class="w-full flex items-center gap-3 rounded-lg px-3 py-2 text-red-100 hover:bg-white/10 transition"
          >
            <span
              class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-white/5 text-xs"
              >üìÑ</span
            >
            <span class="flex-1 text-left">Generate Dokumen</span>
          </button>

          <!-- SIDEBAR: Monitoring Dokumen -->
          <button
            onclick="openMonitoringPanel()"
            class="w-full flex items-center gap-3 rounded-lg px-3 py-2 text-red-100 hover:bg-white/10 transition"
          >
            <span
              class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-white/5 text-xs"
              >üìà</span
            >
            <span class="flex-1 text-left">Monitoring Dokumen</span>
          </button>

          <button
            class="w-full flex items-center gap-3 rounded-lg px-3 py-2 text-red-100 hover:bg-white/10 transition"
          >
          </button>

          <hr class="border-red-800/40 my-3" />

          <h2
            class="px-3 text-[11px] font-semibold uppercase tracking-[0.2em] text-red-100/70 mb-2"
          >
            Lainnya
          </h2>

          <button
            class="w-full flex items-center gap-3 rounded-lg px-3 py-2 text-red-100 hover:bg-white/10 transition"
          >
            <span
              class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-white/5 text-xs"
              >üìù</span
            >
            <span class="flex-1 text-left">Defect Log (Soon)</span>
          </button>

          <button
            class="w-full flex items-center gap-3 rounded-lg px-3 py-2 text-red-100 hover:bg-white/10 transition"
          >
            <span
              class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-white/5 text-xs"
              >üóÉÔ∏è</span
            >
            <span class="flex-1 text-left">Dokumen IT QA (Soon)</span>
          </button>
        </nav>

        <!-- Footer -->
        <div class="px-4 py-3 border-t border-red-800/40 text-[11px] text-red-100/80">
          <p class="font-semibold">IT QA ¬∑ Bank Jakarta</p>
          <p>Version: v1.0 (BETA)</p>
        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <main class="flex-1 flex flex-col">
        <!-- TOP BAR -->
        <header
          class="w-full bg-bj-darkSoft text-slate-100 shadow-md px-4 md:px-6 py-3 flex items-center justify-between gap-4"
        >
          <!-- Logo mini (mobile) -->
          <div class="flex items-center gap-3">
            <div
              class="md:hidden h-9 w-9 flex items-center justify-center rounded-full bg-white/10 border border-white/20 overflow-hidden"
            >
              <img src="bankjakarta.png" alt="Bank Jakarta" class="h-7 object-contain" />
            </div>
            <div>
              <h1 class="text-sm md:text-lg font-semibold">QA Docs Dashboard ¬∑ Bank Jakarta</h1>
              <p class="text-[11px] text-slate-300">
                Panel dokumentasi & monitoring QA untuk channel perbankan.
              </p>
            </div>
          </div>

          <!-- Pills (hitam + oranye) -->
          <div class="flex flex-wrap items-center gap-2 text-[11px]">
            <span
              class="inline-flex items-center rounded-full border border-black/60 bg-black/80 px-3 py-[5px]"
            >
              <span class="w-2 h-2 rounded-full bg-orange-400 mr-2"></span>
              <span class="text-slate-100">Google Sheets ¬∑ Apps Script</span>
            </span>
            <span
              class="inline-flex items-center rounded-full border border-black/60 bg-black/80 px-3 py-[5px]"
            >
              <span class="text-slate-100">
                Mode:
                <span class="font-semibold ml-1 text-orange-300">QA Automation</span>
              </span>
            </span>
            <span
              class="hidden sm:inline-flex items-center rounded-full border border-black/60 bg-black/80 px-3 py-[5px] text-slate-100"
            >
              Version: v1.0 (BETA)
            </span>
          </div>
        </header>

        <!-- CONTENT WRAPPER -->
        <section class="flex-1 p-4 md:p-6">
          <!-- hero gradient card -->
          <div
            class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-bj-redSoft2 via-white to-slate-100 shadow-lg mb-6"
          >
            <div class="absolute inset-0 opacity-25 pointer-events-none">
              <!-- ilustrasi diagonal -->
              <div
                class="absolute -bottom-10 -left-32 w-[340px] h-40 rotate-[-18deg] bg-gradient-to-r from-bj-red to-orange-400 rounded-[40px]"
              ></div>
              <div
                class="absolute -bottom-16 -left-10 w-[340px] h-40 rotate-[-18deg] bg-gradient-to-r from-bj-redSoft to-bj-redSoft2 rounded-[40px]"
              ></div>
            </div>

            <div class="relative px-5 md:px-8 py-4 md:py-5 flex flex-col gap-4">
              <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                  <h2 class="text-xl md:text-2xl font-semibold text-bj-red">
                    Dashboard Dokumentasi QA
                  </h2>
                  <p class="text-[13px] text-bj-dark/80 max-w-xl">
                    Pantau dokumen SIT/UAT, status review, dan progres QA untuk tiap kanal perbankan
                    (JakOne, ATM, CMS, dll) dalam satu tampilan.
                  </p>
                </div>

                <div class="flex flex-wrap gap-2">
                  <!-- HERO: Quick Generate Doc -->
                  <button
                    onclick="openSheetPanel()"
                    class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-orange-400 to-bj-red px-4 py-2 text-xs font-semibold text-white shadow-md hover:shadow-lg hover:brightness-105 transition"
                  >
                    ‚ö° Quick Generate Doc
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- GRID -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 items-start">
            <!-- LEFT COLUMN (2 col) -->
            <div class="lg:col-span-2 space-y-4">
              <!-- Generate card -->
              <div
                class="bg-white rounded-2xl shadow-md border border-slate-200/70 overflow-hidden"
              >
                <div class="px-5 py-4 flex items-center justify-between gap-4">
                  <div class="flex items-center gap-3">
                    <div
                      class="h-10 w-10 flex items-center justify-center rounded-xl bg-bj-redSoft2 border border-bj-redSoft"
                    >
                      <span class="text-bj-red text-xl">üìÑ</span>
                    </div>
                    <div>
                      <h3 class="text-lg font-semibold text-bj-dark">Generate Doc</h3>
                      <p class="text-xs text-slate-500">
                        Buat dokumen QA (SIT/UAT, evidence, dsb) langsung dari data di Sheets.
                      </p>
                    </div>
                  </div>
                  <span
                    class="text-[11px] rounded-full bg-bj-redSoft2 border border-bj-redSoft px-3 py-[3px] text-bj-red"
                    >Mode: Auto Template</span
                  >
                </div>
                <div class="px-5 pb-4 text-[13px] text-slate-600">
                  <p>
                    Input <strong>Project</strong>, <strong>Tipe Dokumen</strong>, dan
                    <strong>PIC</strong>. Sistem akan mencatat ke sheet dan (opsional) membuat
                    Google Docs dari template standar Bank Jakarta.
                  </p>
                  <div class="mt-4 flex flex-wrap items-center justify-between">
                    <!-- CARD: Buka Generate Doc -->
                    <button
                      onclick="openSheetPanel()"
                      class="inline-flex items-center gap-2 rounded-full bg-bj-red px-4 py-2 text-xs font-semibold text-white shadow-md hover:bg-red-800 transition"
                    >
                      ‚ö° Buka Generate Doc
                    </button>
                    <div class="flex flex-wrap gap-2 text-[10px] text-slate-500">
                      <span class="px-3 py-[3px] rounded-full border border-slate-200"
                        >Standar dokumen QA</span
                      >
                      <span class="px-3 py-[3px] rounded-full border border-slate-200"
                        >Integrasi Sheets‚ÄìDocs</span
                      >
                    </div>
                  </div>
                </div>
              </div>

              <!-- Monitoring card mini -->
              <div
                class="bg-white rounded-2xl shadow-md border border-slate-200/70 overflow-hidden"
              >
                <div class="px-5 py-4 flex items-center justify-between gap-4">
                  <div class="flex items-center gap-3">
                    <div
                      class="h-10 w-10 flex items-center justify-center rounded-xl bg-bj-redSoft2 border border-bj-redSoft"
                    >
                      <span class="text-bj-red text-xl">üìà</span>
                    </div>
                    <div>
                      <h3 class="text-lg font-semibold text-bj-dark">Monitoring Doc</h3>
                      <p class="text-xs text-slate-500">
                        Lihat jumlah dokumen yang sudah selesai, masih review, atau belum
                        terbentuk.
                      </p>
                    </div>
                  </div>
                  <span
                    class="text-[11px] rounded-full bg-bj-redSoft2 border border-bj-redSoft px-3 py-[3px] text-bj-red"
                    >Mode: Tracking</span
                  >
                </div>

                <div class="px-5 pb-4 text-[13px] text-slate-600">
                  <p>
                    Data diambil dari sheet <strong>QA_Docs</strong>, sehingga bisa
                    diintegrasikan dengan monitoring QA yang sudah ada (per channel, per
                    project).
                  </p>
                  <div class="mt-4 flex flex-wrap items-center justify-between">
                    <button
                      onclick="openMonitoringPanel()"
                      class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-bj-darkSoft to-bj-red px-4 py-2 text-xs font-semibold text-white shadow-md hover:brightness-110 transition"
                    >
                      üëÄ Buka Monitoring
                    </button>
                    <div class="flex flex-wrap gap-2 text-[10px] text-slate-500">
                      <span class="px-3 py-[3px] rounded-full border border-slate-200"
                        >Status real-time</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- RIGHT COLUMN ‚Äì Snapshot -->
            <div
              class="bg-white rounded-2xl shadow-md border border-slate-200/70 flex flex-col"
            >
              <div class="px-5 py-4 border-b border-slate-200/60">
                <h3 class="text-lg font-semibold text-bj-dark">
                  Proggress
                </h3>
              </div>

              <div class="px-5 py-4 space-y-4">
                <div class="grid grid-cols-3 gap-3 text-center">
                  <div class="rounded-xl border border-slate-200 bg-slate-50 py-3">
                    <p class="text-[11px] text-slate-500">Dokumen terbentuk</p>
                    <!-- ID untuk angka -->
                    <p id="statGenerated" class="mt-1 text-xl font-semibold text-bj-red">0</p>
                  </div>
                  <div class="rounded-xl border border-slate-200 bg-slate-50 py-3">
                    <p class="text-[11px] text-slate-500">Menunggu review</p>
                    <p id="statReview" class="mt-1 text-xl font-semibold text-orange-500">0</p>
                  </div>
                  <div class="rounded-xl border border-slate-200 bg-slate-50 py-3">
                    <p class="text-[11px] text-slate-500">Selesai / Approved</p>
                    <p id="statApproved" class="mt-1 text-xl font-semibold text-bj-red">0</p>
                  </div>
                </div>

                <p class="text-[11px] text-slate-500">
                  Dokumen <span class="font-semibold">belum dibuat</span>:
                  <span id="statNotCreated" class="font-semibold text-bj-red">0</span>
                </p>

                <div class="mt-2 border-t border-dashed border-slate-200 pt-3">
                  <p class="text-[11px] font-semibold text-slate-600 mb-1">
                    Aktivitas terakhir
                  </p>
                  <!-- UL akan diisi dari API -->
                  <ul id="activityList" class="space-y-1 text-[11px] text-slate-600">
                    <li>‚Ä¢ CMS Sub Account ‚Äì SIT ‚Äì Draft dokumen terbentuk</li>
                    <li>‚Ä¢ JakOne Mobile ‚Äì UAT ‚Äì Evidence tambahan di-upload</li>
                    <li>‚Ä¢ CMS BPJS BPU ‚Äì UAT ‚Äì Menunggu review user</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- PANEL EMBED GOOGLE SHEETS: GENERATE DOC -->
    <div
      id="sheetPanel"
      class="fixed inset-0 z-40 hidden bg-black/40 backdrop-blur-sm"
    >
      <div
        class="absolute inset-y-0 right-0 w-full md:w-4/5 lg:w-3/4 xl:w-2/3 bg-white shadow-2xl flex flex-col"
      >
        <header
          class="flex items-center justify-between px-4 md:px-6 py-3 border-b border-slate-200 bg-slate-50"
        >
          <div class="flex items-center gap-2">
            <img
              src="logo.png"
              alt="Bank Jakarta"
              class="h-7 w-7 rounded-full object-contain"
            />
            <div>
              <p
                class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500"
              >
                Bank Jakarta
              </p>
              <p class="text-sm font-semibold text-slate-800">
                Generate Dokumen QA (Google Sheets)
              </p>
            </div>
          </div>

          <!-- kanan header panel -->
          <div class="flex items-center gap-2">
            <!-- TOMBOL: ke halaman Generatedok.html -->
            <button
              onclick="goToGeneratePage()"
              class="hidden sm:inline-flex items-center gap-2 rounded-full bg-bj-red px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-red-800 transition"
            >
              ‚ûï Tambah Dokumen Baru
            </button>

            <!-- tombol close panel -->
            <button
              onclick="closeSheetPanel()"
              class="text-slate-500 hover:text-slate-800 text-lg leading-none"
            >
              ‚úï
            </button>
          </div>
        </header>

        <div class="flex-1 bg-slate-100">
          <iframe
            id="sheetFrame"
            class="w-full h-full border-0"
            src="about:blank"
            loading="lazy"
          ></iframe>
        </div>
      </div>
    </div>

    <!-- PANEL EMBED GOOGLE SHEETS: MONITORING DOC -->
    <div
      id="monitoringPanel"
      class="fixed inset-0 z-40 hidden bg-black/40 backdrop-blur-sm"
    >
      <div
        class="absolute inset-y-0 right-0 w-full md:w-4/5 lg:w-3/4 xl:w-2/3 bg-white shadow-2xl flex flex-col"
      >
        <header
          class="flex items-center justify-between px-4 md:px-6 py-3 border-b border-slate-200 bg-slate-50"
        >
          <div class="flex items-center gap-2">
            <img
              src="logo.png"
              alt="Bank Jakarta"
              class="h-7 w-7 rounded-full object-contain"
            />
            <div>
              <p
                class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500"
              >
                Bank Jakarta
              </p>
              <p class="text-sm font-semibold text-slate-800">
                Monitoring Dokumen QA (Google Sheets)
              </p>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <!-- buka halaman monitoring full -->
            <button
              onclick="goToMonitoringPage()"
              class="hidden sm:inline-flex items-center gap-2 rounded-full bg-bj-darkSoft px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-black transition"
            >
              üìä Buka Halaman Monitoring
            </button>

            <button
              onclick="closeMonitoringPanel()"
              class="text-slate-500 hover:text-slate-800 text-lg leading-none"
            >
              ‚úï
            </button>
          </div>
        </header>

        <div class="flex-1 bg-slate-100">
          <iframe
            id="monitoringFrame"
            class="w-full h-full border-0"
            src="about:blank"
            loading="lazy"
          ></iframe>
        </div>
      </div>
    </div>

    <script>
      // PUBLISH links (pubhtml) ‚Äì bukan link edit
      const QA_DOC_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vQSK1oaUmpusoYqSm6ZNLVMmPgjcq0F7V07B-t5cKaNCtl1P26IecxZ4SffdXlb7tfwYh8meb9zn3CQ/pubhtml?widget=true&headers=false";

      const MONITORING_DOC_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vTaWRjYIirjB26CNiOVm8s9lQwrQEdQ3xXciaGg-NPZ2o4_Oc8spRCHVOcbI3wJT5BoHWFVOJB-nMj1/pubhtml?gid=1662636747&single=true&widget=true&headers=false";

      // URL Web App Apps Script (doGet) ‚Äì GANTI dengan URL punyamu
      const MONITORING_API_URL =
        "https://script.google.com/macros/s/PASTE_WEB_APP_ID_DI_SINI/exec";

      function openSheetPanel() {
        const panel = document.getElementById("sheetPanel");
        const frame = document.getElementById("sheetFrame");

        frame.src = QA_DOC_URL;
        panel.classList.remove("hidden");
      }

      function closeSheetPanel() {
        document.getElementById("sheetPanel").classList.add("hidden");
      }

      function openMonitoringPanel() {
        const panel = document.getElementById("monitoringPanel");
        const frame = document.getElementById("monitoringFrame");

        frame.src = MONITORING_DOC_URL;
        panel.classList.remove("hidden");
      }

      function closeMonitoringPanel() {
        document.getElementById("monitoringPanel").classList.add("hidden");
      }

      function goToGeneratePage() {
        window.location.href = "Generatedok.html";
      }

      function goToMonitoringPage() {
        window.location.href = "Monitoringdok.html";
      }

      // =======================
      // Ambil data dari API
      // =======================
      async function loadDashboardStats() {
        try {
          if (!MONITORING_API_URL || MONITORING_API_URL.includes("PASTE_WEB_APP_ID_DI_SINI")) {
            console.warn("MONITORING_API_URL belum di-set.");
            return;
          }

          const res = await fetch(MONITORING_API_URL);
          if (!res.ok) {
            console.error("Gagal fetch monitoring API:", res.status, res.statusText);
            return;
          }

          const data = await res.json();

          // Update angka
          document.getElementById("statGenerated").textContent =
            data.totalGenerated ?? 0;
          document.getElementById("statReview").textContent =
            data.totalReview ?? 0;
          document.getElementById("statApproved").textContent =
            data.totalApproved ?? 0;
          document.getElementById("statNotCreated").textContent =
            data.totalNotCreated ?? 0;

          // Update aktivitas terakhir
          const listEl = document.getElementById("activityList");
          listEl.innerHTML = "";

          if (Array.isArray(data.latest) && data.latest.length > 0) {
            data.latest.forEach((item) => {
              const li = document.createElement("li");
              li.textContent = `‚Ä¢ ${item.project} ‚Äì ${item.status} ‚Äì ${item.updated}`;
              listEl.appendChild(li);
            });
          } else {
            const li = document.createElement("li");
            li.textContent = "‚Ä¢ Belum ada aktivitas yang tercatat.";
            listEl.appendChild(li);
          }
        } catch (err) {
          console.error("Error loadDashboardStats:", err);
        }
      }

      // Panggil saat halaman selesai load
      window.addEventListener("DOMContentLoaded", loadDashboardStats);
    </script>
  </body>
</html>
